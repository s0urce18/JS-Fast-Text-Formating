<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>JSFastStyleTextTyping</title>
    <style type='text/css'>
        #block1{
            font-family: monospace;
            font-size: 16pt;
            width: 48%;
            height: 500px;
            border: 1px solid gray;
        }
        #block2{
            font-family: monospace;
            font-size: 16pt;
            width: 48.3%;
            height: 504px;
            border: 1px solid gray;
        }
    </style>
</head>
<body>
    <textarea id='block1'></textarea>
    <div id='block2'></div>
    <script type='text/javascript'>
        blk1 = document.getElementById('block1');
        blk2 = document.getElementById('block2');
        strNext = '';
        colorsEng = ['red', 'blue', 'green', 'yellow', 'orange', 'white', 'black', 'grey', 'pink', 'purple'];
        colorsRus = ['красный', 'синий', 'зеленый', 'желтый', 'ораньжевый', 'белый', 'черный', 'серый', 'розовый', 'фиолетовый'];
        facesEng = ['serif', 'sans-serif', 'cursive', 'fantasy', 'monospace'];
        facesRus = ['антиквенный', 'гротескный', 'курсивный', 'декоративный', 'моноширинный'];
        function main(strOrig, finalBlock) {
            tagStyle = '';
            firstTagElem = 0;
            secondTagElem = 0;
            firstTextElem = 0;
            secondTextElem = 0;
            spanSimple = document.createElement('span');
            if(strOrig.indexOf('~') == -1){
                spanSimple.innerHTML = strOrig;
                finalBlock.append(spanSimple);
            }
            else{
                spanSimple.innerHTML = strOrig.slice(0, strOrig.indexOf('~'));
                finalBlock.append(spanSimple);
                firstTagElem = strOrig.indexOf('~');
                secondTagElem = strOrig.indexOf('~', firstTagElem+1);
                if(secondTagElem != -1){
                    tagStyle = strOrig.slice(firstTagElem+1, secondTagElem);
                    firstTextElem = secondTagElem;
                    firstTagElem = strOrig.indexOf('~', secondTagElem+1);
                    secondTagElem = strOrig.indexOf('~', firstTagElem+1);
                    if(firstTagElem != -1 && secondTagElem != -1){
                        if(tagStyle == strOrig.slice(firstTagElem+1, secondTagElem)){
                            secondTextElem = firstTagElem;
                        }
                        else{
                            while(true){
                                firstTagElem = strOrig.indexOf('~', secondTagElem+1);
                                secondTagElem = strOrig.indexOf('~', firstTagElem+1);
                                if(tagStyle == strOrig.slice(firstTagElem+1, secondTagElem)){
                                    secondTextElem = firstTagElem;
                                    break;
                                }
                            }
                        }
                        if(tagStyle == 'b' || tagStyle == 'ж'){
                            spanBold = document.createElement('span');
                            spanBold.className = "Bold";
                            tagB = document.createElement('b');
                            strNext = (strOrig.slice(strOrig.indexOf('~', secondTextElem+2)+1, strOrig.length));
                            main(strOrig.slice(firstTextElem+1, secondTextElem), tagB);
                            spanBold.append(tagB);
                            finalBlock.append(spanBold);
                            if(strNext.length > 0){
                                main(strNext, blk2);
                            }
                        }
                        else if(tagStyle == 'i' || tagStyle == 'к'){
                            spanItalic = document.createElement('span');
                            spanItalic.className = "Italic";
                            tagI = document.createElement('i');
                            strNext = (strOrig.slice(strOrig.indexOf('~', secondTextElem+2)+1, strOrig.length));
                            main(strOrig.slice(firstTextElem+1, secondTextElem), tagI);
                            spanItalic.append(tagI);
                            finalBlock.append(spanItalic);
                            if(strNext.length > 0){
                                main(strNext, blk2);
                            }
                        }
                        else if(tagStyle == 'u' || tagStyle == 'п'){
                            spanUnderline = document.createElement('span');
                            spanUnderline.className = "Underline";
                            tagU = document.createElement('u');
                            strNext = (strOrig.slice(strOrig.indexOf('~', secondTextElem+2)+1, strOrig.length));
                            main(strOrig.slice(firstTextElem+1, secondTextElem), tagU);
                            spanUnderline.append(tagU);
                            finalBlock.append(spanUnderline);
                            if(strNext.length > 0){
                                main(strNext, blk2);
                            }
                        }
                        else if(tagStyle == 's' || tagStyle == 'з'){
                            spanStrike = document.createElement('span');
                            spanStrike.className = "Strike";
                            tagS = document.createElement('s');
                            strNext = (strOrig.slice(strOrig.indexOf('~', secondTextElem+2)+1, strOrig.length));
                            main(strOrig.slice(firstTextElem+1, secondTextElem), tagS);
                            spanStrike.append(tagS);
                            finalBlock.append(spanStrike);
                            if(strNext.length > 0){
                                main(strNext, blk2);
                            }
                        }
                        else if(tagStyle == 'sup' || tagStyle == 'в'){
                            spanSuperscript = document.createElement('span');
                            spanSuperscript.className = "Superscript";
                            tagSup = document.createElement('sup');
                            strNext = (strOrig.slice(strOrig.indexOf('~', secondTextElem+2)+1, strOrig.length));
                            main(strOrig.slice(firstTextElem+1, secondTextElem), tagSup);
                            spanSuperscript.append(tagSup);
                            finalBlock.append(spanSuperscript);
                            if(strNext.length > 0){
                                main(strNext, blk2);
                            }
                        }
                        else if(tagStyle == 'sub' || tagStyle == 'н'){
                            spanSubscript = document.createElement('span');
                            spanSubscript.className = "Subscript";
                            tagSub = document.createElement('sub');
                            strNext = (strOrig.slice(strOrig.indexOf('~', secondTextElem+2)+1, strOrig.length));
                            main(strOrig.slice(firstTextElem+1, secondTextElem), tagSub);
                            spanSubscript.append(tagSub);
                            finalBlock.append(spanSubscript);
                            if(strNext.length > 0){
                                main(strNext, blk2);
                            }
                        }
                        else if(tagStyle.includes('font_face:') || tagStyle.includes('шрифт_стиль:')){
                            spanFontFace = document.createElement('span');
                            spanFontFace.className = "FontFace";
                            tagFontFace = document.createElement('font');
                            attributeVal = tagStyle.slice(tagStyle.indexOf(':')+1, tagStyle.length).replace('ё', 'е');
                            for(i=0; i<facesRus.length; i++){
                                attributeVal = attributeVal.replace(facesRus[i], facesEng[i]);
                            }
                            tagFontFace.setAttribute('face', attributeVal)
                            strNext = (strOrig.slice(strOrig.indexOf('~', secondTextElem+2)+1, strOrig.length));
                            main(strOrig.slice(firstTextElem+1, secondTextElem), tagFontFace);
                            spanFontFace.append(tagFontFace);
                            finalBlock.append(spanFontFace);
                            if(strNext.length > 0){
                                main(strNext, blk2);
                            }
                        }
                        else if(tagStyle.includes('font_size:') || tagStyle.includes('шрифт_размер:')){
                            spanFontSize = document.createElement('span');
                            spanFontSize.className = "FontSize";
                            tagFontSize = document.createElement('font');
                            tagFontSize.setAttribute('size', tagStyle.slice(tagStyle.indexOf(':')+1, tagStyle.length).replace('пт', 'pt').replace('пк', 'px'))
                            strNext = (strOrig.slice(strOrig.indexOf('~', secondTextElem+2)+1, strOrig.length));
                            main(strOrig.slice(firstTextElem+1, secondTextElem), tagFontSize);
                            spanFontSize.append(tagFontSize);
                            finalBlock.append(spanFontSize);
                            if(strNext.length > 0){
                                main(strNext, blk2);
                            }
                        }
                        else if(tagStyle.includes('font_color:') || tagStyle.includes('шрифт_цвет:')){
                            spanFontColor = document.createElement('span');
                            spanFontColor.className = "FontColor";
                            tagFontColor = document.createElement('font');
                            attributeVal = tagStyle.slice(tagStyle.indexOf(':')+1, tagStyle.length).replace('ё', 'е');
                            for(i=0; i<colorsRus.length; i++){
                                attributeVal = attributeVal.replace(colorsRus[i], colorsEng[i]);
                            }
                            tagFontColor.setAttribute('color', attributeVal)
                            strNext = (strOrig.slice(strOrig.indexOf('~', secondTextElem+2)+1, strOrig.length));
                            main(strOrig.slice(firstTextElem+1, secondTextElem), tagFontColor);
                            spanFontColor.append(tagFontColor);
                            finalBlock.append(spanFontColor);
                            if(strNext.length > 0){
                                main(strNext, blk2);
                            }
                        }
                    }
                }
            }
        }

        function closer(strOrig) {
            tagStyle = '';
            firstTagElem = 0;
            secondTagElem = 0;
            secondTagElem = strOrig.lastIndexOf('~');
            firstTagElem = strOrig.lastIndexOf('~', secondTagElem-1);
            return strOrig.slice(firstTagElem, secondTagElem+1);
        }

        document.addEventListener('keydown', function(e) {
        if (e.code == 'Backquote' && (e.altKey || e.metaKey)) {
            e.target.value += '~';
            blk2.innerHTML = "";
            main(e.target.value.replace(/\n/g, '<br/>'), blk2);
        }
        else if (e.code == 'KeyB' && (e.altKey || e.metaKey)) {
            e.target.value += '~b~';
            blk2.innerHTML = "";
            main(e.target.value.replace(/\n/g, '<br/>'), blk2);
        }
        else if (e.code == 'KeyI' && (e.altKey || e.metaKey)) {
            e.target.value += '~i~';
            blk2.innerHTML = "";
            main(e.target.value.replace(/\n/g, '<br/>'), blk2);
        }
        else if (e.code == 'KeyU' && (e.altKey || e.metaKey)) {
            e.target.value += '~u~';
            blk2.innerHTML = "";
            main(e.target.value.replace(/\n/g, '<br/>'), blk2);
        }
        else if (e.code == 'KeyS' && (e.altKey || e.metaKey)) {
            e.target.value += '~s~';
            blk2.innerHTML = "";
            main(e.target.value.replace(/\n/g, '<br/>'), blk2);
        }
        else if (e.code == 'KeyF' && (e.altKey || e.metaKey)) {
            e.target.value += '~font_~';
            blk2.innerHTML = "";
            main(e.target.value.replace(/\n/g, '<br/>'), blk2);
        }
        else if (e.code == 'KeyC' && (e.altKey || e.metaKey)) {
            e.target.value += closer(e.target.value.replace(/\n/g, '<br/>'));
            blk2.innerHTML = "";
            main(e.target.value.replace(/\n/g, '<br/>'), blk2);
        }
        });

        blk1.addEventListener('input', function(e){
            blk2.innerHTML = "";
            main(e.target.value.replace(/\n/g, '<br/>'), blk2);
            })
    </script>
</body>
</html>